# bingwu（超短复盘 & 次日作战）评分标准

本文件描述 `bingwu.py` 的打分与输出逻辑，供复现与后续迭代使用。

> 定位：超短复盘系统的「次日是否允许交易」与「1–2 个可操作标的 + 计划」自动生成。

---

## 1) 市场情绪周期判定（全局开关）

输入（AkShare 为主）：
- 全市场涨停数 `limit_up_count`
- 全市场跌停数 `limit_down_count`
- 市场最高连板 `max_consecutive`
- 昨日最高连板 `prev_max_consecutive`（可选）
- 炸板率 `broken_rate = broken_count / (broken_count + sealed_count)`

周期判定（输出 `market_emotion`）：
- **上升期**：连板高度上升（`max_consecutive > prev_max_consecutive`）且跌停少、炸板率低
- **震荡期**：连板高度持平/小波动，跌停/炸板率中性
- **退潮期**：连板高度下降或跌停偏多或炸板率偏高

情绪分（输出 `emotion_score`，0–100）：
- 以 50 为基准，按涨停数、跌停数、炸板率、连板趋势进行加减分
- 最终截断到 `[0, 100]`

交易许可（输出 `operation_permission`）：
- **退潮期**（或风险信号过强）直接 `false`
- `operation_permission=false` 时，后续模块跳过，仅输出空仓建议与仓位/风险

---

## 2) 题材扫描与强度评估（概念 + 行业）

输入：
- 对涨停股表补齐两类归属：
  - 概念（避免把“涨停原因”当概念板块）：
    1) 涨停池自带字段：`所属概念/所属题材/概念/题材`
    2) `stock_individual_info_em`（若提供“所属概念/概念板块”等）
    3) 同花顺概念板块（AkShare THS 接口；若网络触发 401/login 可能返回空）
  - 行业：使用 AkShare 个股信息接口补齐（字段“行业”）

题材强度评分（0–8，输出 `theme_score`）：
- 新题材（相对昨日新增，且当日涨停数达到阈值） `+2`
- 板块涨停数 `>=5` `+2`（贴合 `descriptions/bingwu.md` 建议阈值）
- 龙头高度：板块最高连板达到全市场最高（或并列） `+2`
- 尾盘回流：14:30 后仍有封板/回流迹象 `+2`

核心题材判定：
- `theme_score >= 5` => `is_core_theme=true`

> 约束：空值不会被当作“未知题材”；只有真实题材才参与扫描与评分。

---

## 3) 龙头识别与结构阶段

候选筛选：
- 仅从核心题材内挑选（优先概念，其次行业）
- 默认只输出 1–2 只（龙头/次龙）

结构阶段（输出 `structure_stage`）：
- 启动期：`lb_count <= 1`
- 主升初期：`2 <= lb_count <= 3`
- 高位期：`lb_count >= 4`

结构分（0–5，输出 `structure_score`）：
- 连板高度（>=2 加分）
- 开板/炸板次数（越少越好）
- 封板时间结构：越接近板块早封分位越好
- 尾盘封板可加分

---

## 4) 个股可交易性评分（0–8）

输出：
- `tradable`：是否写入次日交易计划
- `stock_score`：0–8

打分维度（示意）：
- 核心题材归属 `+2`
- 市场情绪为上升/震荡且允许交易 `+2`
- 相对位置低位 `+1`（基于近端历史的区间分位）
- 封板质量 `+0~2`
- 换手结构非天量 `+1`
- 高位期会做降权/更保守

准入线：
- `stock_score >= 6` => `tradable=true`

---

## 5) 次日交易计划生成

每只入选标的输出：
- `operation_type`：打板/半路/低吸（按连板阶段映射）
- `entry_conditions`：必须可程序化判断（如开盘涨幅阈值、突破昨日高点等）
- `stop_loss_rules`：必须可程序化判断
- `take_profit_logic`、`sell_plan`

---

## 6) 仓位与风险控制

输出 `risk`：
- 上升期：`max_position=50%`，风险低
- 震荡期：`max_position=30%`，风险中
- 退潮期：`max_position=0%`，风险高
